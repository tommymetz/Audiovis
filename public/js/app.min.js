function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,_toPropertyKey(s.key),s)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);i=i.call(t,e||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var Helper=(()=>_createClass(function t(e,i){_classCallCheck(this,t);this.scene=e,this.stem=i,this.initHelper()},[{key:"initHelper",value:function(){var t="".concat(this.stem.order," - ").concat(this.stem.name),e=document.createElement("canvas"),i=e.getContext("2d"),i=(e.width=256,e.height=128,i.font="16px Arial",i.fillStyle="white",i.fillText(t,0,20),new THREE.Texture(e)),t=(i.needsUpdate=!0,new THREE.PlaneGeometry(1,.5)),e=new THREE.MeshBasicMaterial({map:i,transparent:!0,side:THREE.DoubleSide}),i=new THREE.Mesh(t,e);i.position.set(-1.5,1,.01),this.stem.rootobject.add(i)}},{key:"updateHelper",value:function(){}}]))();function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,_toPropertyKey(s.key),s)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);i=i.call(t,e||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var Spectrum=(()=>_createClass(function t(e,i,s){_classCallCheck(this,t);this.scene=e,this.stem=i,this.color=s,this.initSpectrum()},[{key:"initSpectrum",value:function(){if(this.stem.centroids&&this.stem.centroids[0]){var t=2*this.stem.centroids[0].length,e=new THREE.BufferGeometry,i=new Float32Array(3*t),s=new Float32Array(3*t),t=(e.setAttribute("position",new THREE.BufferAttribute(i,3)),e.setAttribute("normal",new THREE.BufferAttribute(s,3)),new THREE.MeshBasicMaterial({color:this.color,wireframe:!1,side:THREE.DoubleSide,transparent:!0,opacity:.75}));this.spectrum=new THREE.Mesh(e,t),this.spectrum.position.x=0,this.spectrum.position.y=this.stem.offsety,this.stem.rootobject.add(this.spectrum);for(var n,o,r,a,l=(i=this.spectrum.geometry.attributes.position.array).length/3/3,h=1,u=-1,c=0,d=0;d<3*l;d++)d%3==0&&(u++,h=0==h?1:0),a=u-c,0==h?r=(o=d%3==0?(n=0,Math.log10(a)):d%3==1?(n=1,Math.log10(a)):(n=1,Math.log10(1+a)),0):d%3==0?(n=0,o=Math.log10(a),r=0):d%3==1?(n=0,o=Math.log10(a-.9),r=0):(n=.9,o=Math.log10(a),r=0,c++),n<=0&&(n=0),o<=0&&(o=0),r<=0&&(r=0),i[a=3*d]=n,i[1+a]=o,i[2+a]=r;for(var p=(s=this.spectrum.geometry.attributes.normal.array).length,d=0;d<p;d++)s[d]=-1;this.spectrum.geometry.computeVertexNormals(),this.spectrummirror=new THREE.Mesh(e,t),this.spectrummirror.position.x=0,this.spectrummirror.position.y=this.stem.offsety,this.spectrummirror.rotation.y=+Math.PI,this.stem.rootobject.add(this.spectrummirror)}}},{key:"updateSpectrum",value:function(){if(this.spectrum&&this.stem.centroids&&this.stem.centroid_indexes){var t=this.stem.json.track.byte_num_range;if(!(isNaN(this.stem.frame)||this.stem.frame<0||this.stem.frame>=this.stem.centroid_indexes.length)){var e=this.stem.centroid_indexes[this.stem.frame];if(void 0!==e&&this.stem.centroids[e]){for(var i,s,n,o,r,a=this.spectrum.geometry.attributes.position.array,l=a.length/3/3,h=1,u=-1,c=0,d=0;d<3*l;d++)d%3==0&&(u++,h=0==h?1:0),r=u-c,0==h?n=(s=d%3==0?(i=0,Math.log10(r)):d%3==1?(o=Math.log10(this.stem.volume[this.stem.frame]/t*1e5)/10,i=Math.log(this.stem.centroids[e][r]/t*1e5)/2*o,Math.log10(r)):(o=Math.log10(this.stem.volume[this.stem.frame]/t*1e5)/10,i=Math.log(this.stem.centroids[e][1+r]/t*1e5)/2*o,Math.log10(1+r)),0):d%3==0?(i=0,s=Math.log10(r),n=0):d%3==1?(i=0,s=Math.log10(r-1),n=0):(o=Math.log10(this.stem.volume[this.stem.frame]/t*1e5)/10,i=Math.log(this.stem.centroids[e][r]/t*1e5)/2*o*1,s=Math.log10(r),n=0,c++),i<=0&&(i=0),s<=0&&(s=0),n<=0&&(n=0),a[r=3*d]=i,a[1+r]=s,a[2+r]=n;this.spectrum.geometry.attributes.position.needsUpdate=!0}}}else console.warn("Spectrum update skipped due to undefined centroids or centroid indexes.")}},{key:"updateColor",value:function(t){this.spectrum&&this.spectrummirror&&(this.spectrum.material.color.set(t),this.spectrummirror.material.color.set(t))}}]))();function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,_toPropertyKey(s.key),s)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);i=i.call(t,e||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var Triangles=(()=>_createClass(function t(e,i,s){_classCallCheck(this,t);this.scene=e,this.stem=i,this.color=s,this.zeroed=!1,this.yoffset=.15,this.initTriangles(),this.generateTriangleGeometry()},[{key:"initTriangles",value:function(){var t,e,i;this.stem.centroids&&this.stem.centroids[0]&&(e=2*this.stem.centroids[0].length,t=new THREE.BufferGeometry,i=new Float32Array(3*e),e=new Float32Array(3*e),t.setAttribute("position",new THREE.BufferAttribute(i,3)),t.setAttribute("normal",new THREE.BufferAttribute(e,3)),i=new THREE.MeshBasicMaterial({color:this.color,side:THREE.DoubleSide,wireframe:!1}),this.triangles=new THREE.Mesh(t,i),this.triangles.position.x=0,this.triangles.position.y=this.yoffset,this.stem.rootobject.add(this.triangles),this.trianglesmirror=new THREE.Mesh(t,i),this.trianglesmirror.position.x=0,this.trianglesmirror.position.y=this.yoffset,this.trianglesmirror.rotation.y=+Math.PI,this.stem.rootobject.add(this.trianglesmirror))}},{key:"generateTriangleGeometry",value:function(){for(var t,e,i=this.triangles.geometry.attributes.position.array,s=(i.length,0);s<30;s++){var n=s%3==0?e=t=0:(t+=.5*(Math.random()-.5),e+=.5*(Math.random()-.5),0),o=3*s;i[o]=t,i[1+o]=e,i[2+o]=n}this.triangles.geometry.attributes.position.needsUpdate=!0}},{key:"updateTriangles",value:function(){var t;this.triangles&&this.stem.volume&&((t=+Math.log10(this.stem.volume[this.stem.frame]/this.stem.multiplyer*this.stem.factor*this.stem.maxvolume))<=.5?this.zeroed||(this.generateTriangleGeometry(),this.zeroed=!0):this.zeroed&&(this.zeroed=!1),this.triangles.scale.set(t=t<=0?1e-4:t,t,t),this.trianglesmirror.scale.set(t,t,t))}},{key:"updateColor",value:function(t){this.triangles&&this.trianglesmirror&&(this.triangles.material.color.set(t),this.trianglesmirror.material.color.set(t))}}]))(),colorsWarmCold=["#FFFFFF","#6F256F","#530E53","#9D344B","#761429","#482E74","#2D1557","#8A458A","#C56277"];function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,_toPropertyKey(s.key),s)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);i=i.call(t,e||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var SceneGui=(()=>_createClass(function t(e){_classCallCheck(this,t);this.parent=e,this.visible=!1,this.paused=!1,this.state={},this.container=document.createElement("div"),this.parent.container.appendChild(this.container),this.container.setAttribute("class","scene-gui gui-container hidden"),this.menu=document.createElement("div"),this.container.appendChild(this.menu),this.menu.setAttribute("class","gui-menu"),this.button_stopplay=document.createElement("a"),this.menu.appendChild(this.button_stopplay),this.button_stopplay.setAttribute("class","gui-item"),this.button_stopplay.setAttribute("href","#"),this.button_stopplay.innerHTML="stop",this.button_fastforward=document.createElement("a"),this.menu.appendChild(this.button_fastforward),this.button_fastforward.setAttribute("class","gui-item"),this.button_fastforward.setAttribute("href","#"),this.button_fastforward.innerHTML="ff",this.button_nextsong=document.createElement("a"),this.menu.appendChild(this.button_nextsong),this.button_nextsong.setAttribute("class","gui-item"),this.button_nextsong.setAttribute("href","#"),this.button_nextsong.innerHTML="next",this.button_buy=document.createElement("a"),this.menu.appendChild(this.button_buy),this.button_buy.setAttribute("class","gui-item"),this.button_buy.setAttribute("href","http://multidim.net/releases/horizon"),this.button_buy.setAttribute("target","_blank"),this.button_buy.innerHTML="get",this.song_title=document.createElement("div"),this.container.appendChild(this.song_title),this.song_title.setAttribute("class","gui-song-title"),this.song_title.innerHTML="Glissline - Horizon"},[{key:"init",value:function(){var e=this;this.updateVisibility(!0),this.button_stopplay.addEventListener("click",function(t){t.preventDefault(),e.stopplay()}),this.button_fastforward.addEventListener("click",function(t){t.preventDefault(),e.fastforward()}),this.button_nextsong.addEventListener("click",function(t){t.preventDefault(),e.nextsong()})}},{key:"updateSongTitle",value:function(t){this.song_title.innerHTML=t}},{key:"updateStopPlayButtonState",value:function(t){t?(this.button_stopplay.innerHTML="play",this.paused=!0):(this.button_stopplay.innerHTML="stop",this.paused=!1)}},{key:"updateVisibility",value:function(t){(this.visible=t)?this.container.classList.remove("hidden"):this.container.classList.add("hidden")}},{key:"stopplay",value:function(){this.paused?(this.button_stopplay.innerHTML="stop",this.paused=!1):(this.button_stopplay.innerHTML="play",this.paused=!0),this.parent.stopplay()}},{key:"fastforward",value:function(){this.button_stopplay.innerHTML="stop",this.paused=!1,document.getElementById("playdiv").style.display="none",this.parent.fastforward()}},{key:"nextsong",value:function(){this.button_stopplay.innerHTML="stop",this.paused=!1,document.getElementById("playdiv").style.display="none",this.parent.nextsong()}}]))();function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,_toPropertyKey(s.key),s)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);i=i.call(t,e||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,_toPropertyKey(s.key),s)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);i=i.call(t,e||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(()=>{window.onload=function(){var t;(()=>{try{var t=document.createElement("canvas");return window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(t){}})()?-1<(t=navigator.userAgent).indexOf("MSIE ")||-1<t.indexOf("Trident/")?document.getElementById("loading").innerHTML="Please use a different browser. This site works best in Chrome.":new e:(console.log("WebGL is not available in this browser"),document.getElementById("loading").innerHTML="This browser does not support WebGL")};var e=(()=>_createClass(function t(){_classCallCheck(this,t);var e=this;this.export=!1,this.stop_on_next=!1,this.hide_controls=!0,this.container=document.getElementById("container"),this.loadingdiv=document.getElementById("loading"),this.playdiv=document.getElementById("playdiv"),this.scene=new THREE.Scene,this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),this.camera=new THREE.PerspectiveCamera(10,window.innerWidth/window.innerHeight,.1,1e4),this.cameralookat=new THREE.Vector3(0,1.2,0),this.renderer.shadowMap.enabled=!0,this.renderer.setSize(window.innerWidth,window.innerHeight),this.container.appendChild(this.renderer.domElement),this.audiolistener=new THREE.AudioListener,this.camera.add(this.audiolistener),this.app_preloaded=!1,this.fps=24,this.animationstart=0,this.now,this.then=Date.now(),this.interval=1e3/this.fps,this.delta,this.frame=0,this.currentsong=0,this.gui=new SceneGui(this),this.stats=new Stats,this.stats.showPanel(1),this.stats.domElement.style.position="absolute",this.stats.domElement.style.bottom="0px",this.stats.domElement.style.zIndex=100,this.hide_controls||this.container.appendChild(this.stats.domElement),document.getElementById("game-stop").addEventListener("click",function(t){t.preventDefault(),e.stopplay()}),document.getElementById("playdiv-begin").addEventListener("click",function(t){t.preventDefault(),e.playdiv.style.display="none",e.app_preloaded?(e.stopplay(),e.gui.updateStopPlayButtonState(!1)):e.preloaded()}),this.initScene()},[{key:"initScene",value:function(t){var o=this;this.orbitcontrols=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.camera.position.set(0,-10,22),this.camera.lookAt(this.cameralookat),window.addEventListener("resize",function(){o.camera.aspect=window.innerWidth/window.innerHeight,o.camera.updateProjectionMatrix(),o.renderer.setSize(window.innerWidth,window.innerHeight)},!1);var e=new THREE.DirectionalLight(16777215,.5),e=(e.rotation.set(0,0,0),e.position.set(0,0,5),this.scene.add(e),new THREE.PlaneGeometry(2,4)),i=new THREE.MeshStandardMaterial({color:16777215,side:THREE.DoubleSide,transparent:!0,opacity:.2});this.floor=new THREE.Mesh(e,i),this.floor.position.set(0,0,0),this.floor.rotation.set(Math.PI/2,0,0),this.scene.add(this.floor),this.loadJSON("content/_playlist.json",function(t){o.playlist=JSON.parse(t),o.songs=[];for(var e,i=o.playlist.songs.length,s=0,n=0;n<i;n++)e="content/"+o.playlist.songs[n]+"/",o.songs[n]=new Song(o,e,"_analysis_files.json","_config.json",o.scene,o.audiolistener,o.fps,o.hide_controls),o.songs[n].onLoaded=function(){s++,o.loadingdiv.innerHTML='<img src="img/loading-icon.gif" width="30" /><br>Loading Interactive Experience<br>Song '+s+" of "+i+" loaded";for(var t=!0,e=0;e<i;e++)o.songs[e].loaded||(t=!1);t&&(o.loadingdiv.style.visibility="hidden",o.playdiv.style.display="block")}})}},{key:"preloaded",value:function(){var t=this;this.app_preloaded=!0,this.loadingdiv.style.visibility="hidden",setTimeout(function(){t.gui.init(),t.initAnimate(),t.play(t.currentsong)},1e3)}},{key:"play",value:function(t){t&&(this.currentsong=t),this.songs[this.currentsong].play(0);t='"'+this.songs[this.currentsong].mp3file.substring(0,this.songs[this.currentsong].mp3file.length-4)+'"';this.gui.updateSongTitle(t)}},{key:"stopplay",value:function(){var t=this;this.paused?(this.songs[this.currentsong].play(),this.playdiv.style.display="none",this.paused=!1,requestAnimationFrame(function(){t.animate()})):(this.songs[this.currentsong].stop(),this.playdiv.style.display="block",this.paused=!0)}},{key:"fastforward",value:function(){this.paused=!1,this.songs[this.currentsong].fastforward()}},{key:"nextsong",value:function(){var t;this.paused=!1,this.stop_on_next?this.stopplay():((t=this).songs[this.currentsong].stop(),setTimeout(function(){t.currentsong++,t.currentsong==t.playlist.songs.length&&(t.currentsong=0),t.play()},0))}},{key:"initAnimate",value:function(){var t=this;this.paused=!1,this.frame=0,this.animationstart=Date.now(),this.renderer.render(this.scene,this.camera),requestAnimationFrame(function(){t.animate()})}},{key:"animate",value:function(){var t=this;requestAnimationFrame(function(){t.animate()}),this.now=Date.now(),this.delta=this.now-this.then,this.delta>this.interval&&(this.updateScene(),this.then=this.now-this.delta%this.interval,this.renderer.render(this.scene,this.camera),this.export,this.stats.update(),this.frame=Math.round((this.now-this.animationstart)/41.666666666))}},{key:"updateScene",value:function(){this.songs[this.currentsong].updateAnimation(),this.camera.lookAt(this.cameralookat)}},{key:"loadJSON",value:function(t,e){var i=new XMLHttpRequest;i.overrideMimeType("application/json"),i.open("GET",t,!0),i.onreadystatechange=function(){4==i.readyState&&"200"==i.status&&e(i.responseText)},i.send(null)}}]))()})();var SongGui=(()=>_createClass(function t(e){_classCallCheck(this,t);this.parent=e,this.visible=!1,this.state={location:e.location,order:[],colorset:"colorsWarmCold",colors:[]},this.container=document.createElement("div"),this.parent.parent.container.appendChild(this.container),this.container.setAttribute("class","song-gui gui-container hidden"),this.menu=document.createElement("div"),this.container.appendChild(this.menu),this.menu.setAttribute("class","gui-menu"),this.title=document.createElement("div"),this.menu.appendChild(this.title),this.title.setAttribute("class","gui-item gui-item_title"),this.status_changed=document.createElement("div"),this.menu.appendChild(this.status_changed),this.status_changed.setAttribute("class","gui-item gui-item_changed"),this.status=document.createElement("div"),this.menu.appendChild(this.status),this.status.setAttribute("class","gui-item gui-item_status"),this.button_load=document.createElement("a"),this.menu.appendChild(this.button_load),this.button_load.setAttribute("class","gui-item"),this.button_load.setAttribute("href","#"),this.button_load.innerHTML="load",this.button_save=document.createElement("a"),this.menu.appendChild(this.button_save),this.button_save.setAttribute("class","gui-item"),this.button_save.setAttribute("href","#"),this.button_save.innerHTML="save",this.stems=[],this.stems_list=document.createElement("ul"),this.container.appendChild(this.stems_list),this.stems_list.setAttribute("class","gui-list")},[{key:"init",value:function(){var e=this,s=this,n=(this.title.innerHTML=this.parent.mp3file,this.button_load.addEventListener("click",function(t){t.preventDefault(),e.visible?s.loadState():console.log("fuck off")}),this.button_save.addEventListener("click",function(t){t.preventDefault(),e.visible?s.saveState():console.log("fuck off")}),this.state.colors=this.parent.colors,this.state.order=this.parent.order,new Array(this.parent.stems.length));this.parent.stems.forEach(function(t,e){t.order;s.stems[e]=document.createElement("li"),s.stems[e].setAttribute("data-index",e);var i=document.createElement("div"),i=(i.setAttribute("class","name"),i.innerHTML=s.parent.stems[e].name,s.stems[e].appendChild(i),document.createElement("input")),i=(i.setAttribute("type","color"),i.setAttribute("value",s.state.colors[e]),s.parent.stems[e].active||i.setAttribute("disabled",!0),s.stems[e].appendChild(i),i.addEventListener("input",function(t){s.status_changed.innerHTML="*";var e=t.target.parentElement.getAttribute("data-index");s.state.colors[e]=t.target.value,s.parent.updateStemColor(e,t.target.value)},!1),document.createElement("input"));i.setAttribute("type","checkbox"),s.parent.stems[e].active||i.setAttribute("disabled",!0),s.stems[e].appendChild(i),i.addEventListener("change",function(t){t=t.target.parentElement.getAttribute("data-index");s.parent.updateSoloing(t,this.checked),s.updateSoloing(t,this.checked)}),s.parent.stems[e].active||(s.stems[e].className+="inactive"),n[t.order]=s.stems[e]}),n.forEach(function(t,e){s.stems_list.appendChild(t)}),Sortable.create(s.stems_list,{onEnd:function(t){for(var e=new Array(t.target.children.length),i=0;i<t.target.children.length;++i)e[parseInt(t.target.children[i].getAttribute("data-index"))]=i;s.state.order=e,s.parent.updateStemOrder(e),s.status_changed.innerHTML="*"}})}},{key:"updateVisibility",value:function(t){(this.visible=t)?this.container.classList.remove("hidden"):this.container.classList.add("hidden")}},{key:"updateSoloing",value:function(i,t){t?this.stems.forEach(function(t,e){i!=e&&t.classList.add("hidden")}):this.stems.forEach(function(t,e){t.classList.remove("hidden")})}},{key:"loadState",value:function(){console.log("load state")}},{key:"saveState",value:function(){var t=this,e=(this.status.innerHTML="saving",new XMLHttpRequest);e.onreadystatechange=function(){4==this.readyState&&200==this.status&&(t.status.innerHTML="",t.status_changed.innerHTML="",console.log(JSON.parse(this.responseText)))},e.open("POST","/config/save",!0),e.setRequestHeader("Content-type","application/json"),e.send(JSON.stringify(this.state))}}]))();function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,_toPropertyKey(s.key),s)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);i=i.call(t,e||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var Song=function(){function Song(parent,location,songjsonfile,attributesjson,scene,audiolistener,fps){var hide_controls=7<arguments.length&&void 0!==arguments[7]&&arguments[7],mythis=(_classCallCheck(this,Song),this);this.parent=parent,this.location=location,this.songjsonfile=songjsonfile,this.attributesjson=attributesjson,this.scene=scene,this.audiolistener=audiolistener,this.fps=fps,this.hide_controls=hide_controls,this.active=!1,this.audiotrack=new THREE.Audio(this.audiolistener),this.scene.add(this.audiotrack),this.mp3file,this.firststarttime=0,this.ignoreending=!1,this.stemnames=[],this.stems=[],this.loadingstage=0,this.order=[],this.colors=[],this.loaded=!1,this.visible=!1,this.gui=new SongGui(this),this.stemgroup=new THREE.Group,this.stemgroup.position.set(0,0,1.2),this.scene.add(this.stemgroup),this.frame=0,this.offset=0,this.starttime=0,this.isLoaded=function(){"function"==typeof this.onLoaded&&(this.loaded=!0,this.gui.init(),this.onLoaded())},mythis.loadJSON("".concat(mythis.location+mythis.songjsonfile),function(response){var json=JSON.parse(response);mythis.mp3file=json[0].mp3file,mythis.stemnames=json[0].audiofiles,mythis.loadJSON("".concat(mythis.location+mythis.attributesjson),function(response){var json=JSON.parse(response),colorindex,colorset,loader=(mythis.attributes=json,0==mythis.attributes.colors.length?(colorindex=0,colorset=eval(mythis.attributes.colorset),mythis.stemnames.forEach(function(t,e){mythis.colors.push(colorset[colorindex]),colorindex++,e==colorset.length-1&&(colorindex=0)})):mythis.colors=mythis.attributes.colors,0==mythis.attributes.order.length?mythis.stemnames.forEach(function(t,e){mythis.order.push(e)}):mythis.order=mythis.attributes.order,new THREE.AudioLoader);loader.load(mythis.location+mythis.mp3file,function(t){mythis.audiotrack.setBuffer(t),mythis.audiotrack.setLoop(!1),mythis.audiotrack.setVolume(1),mythis.audiotrack.onEnded=function(){mythis.ignoreending||mythis.visible&&(mythis.updateVisibility(!1),mythis.parent.nextsong())};for(var e=0;e<mythis.stemnames.length;e++)mythis.stems[e]=mythis.createStem(mythis.stemnames[e],e,mythis.order[e])})})})}return _createClass(Song,[{key:"createStem",value:function(t,e,i){var s=this,t=new Stem(this.location,t,e,i,this.scene,this.stemgroup,this.colors[e]);return t.onLoaded=function(){for(var t=!0,e=0;e<s.stemnames.length;e++)s.stems[e].loaded||(t=!1);t&&s.isLoaded()},t}},{key:"updateVisibility",value:function(t){this.visible=t,this.hide_controls?this.gui.updateVisibility(!1):this.gui.updateVisibility(t);for(var e=0;e<this.stemnames.length;e++)this.stems[e].updateVisibility(t)}},{key:"updateStemOrder",value:function(t){for(var e=0;e<this.stemnames.length;e++)this.stems[e].updateOrder(t[e])}},{key:"updateStemColor",value:function(t,e){this.stems[t].updateColors(e)}},{key:"updateSoloing",value:function(i,t){t?this.stems.forEach(function(t,e){i!=e&&t.hide()}):this.stems.forEach(function(t,e){t.show()})}},{key:"play",value:function(){this.offset=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,this.offsetframes=this.offset*this.fps,this.audiotrack.isPlaying&&this.audiotrack.stop(),this.audiotrack.offset=this.offset,this.audiotrack.play(),this.starttime=this.audiotrack.context.currentTime,this.updateVisibility(!0)}},{key:"stop",value:function(){this.updateVisibility(!1),this.audiotrack.isPlaying&&this.audiotrack.stop()}},{key:"fastforward",value:function(){var t=this,e=(this.ignoreending=!0,this.audiotrack.context.currentTime+this.audiotrack.offset+5);e<this.audiotrack.buffer.duration?(this.play(e),setTimeout(function(){t.ignoreending=!1},10)):(this.updateVisibility(!1),this.parent.nextsong())}},{key:"updateAnimation",value:function(){if(this.visible){var t=(this.audiotrack.context.currentTime-this.starttime)*this.fps;if(console.log(this.audiotrack.context.currentTime,this.starttime,this.fps,t),this.frame=Math.round(t+this.offsetframes),!(isNaN(this.frame)||this.frame<0))for(var e=0;e<this.stems.length;e++)this.stems[e].updateAnimation(this.frame)}}},{key:"loadJSON",value:function(t,e){var i=new XMLHttpRequest;i.overrideMimeType("application/json"),i.open("GET",t,!0),i.onreadystatechange=function(){4==i.readyState&&"200"==i.status&&e(i.responseText)},i.send(null)}}])}();function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,_toPropertyKey(s.key),s)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);i=i.call(t,e||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var Stem=(()=>_createClass(function t(e,i,s,n,o,r,a){_classCallCheck(this,t),this.location=e,this.name=i,this.index=s,this.order=n,this.scene=o,this.stemgroup=r,this.color=a,this.jsonfile="".concat(this.name,"_analysis.json"),this.datafile="".concat(this.name,"_analysis.data"),this.steminfo,this.datastructure,this.loaded=!1,this.active=!0,this.visible=!1,this.volume,this.balance,this.width,this.centroids,this.centroid_indexes,this.pitch,this.isLoaded=function(){this.loaded=!0,"function"==typeof this.onLoaded&&this.onLoaded()},this.init()},[{key:"init",value:function(){var e=this;this.json=new Object,this.loadJSON(this.location+this.jsonfile,function(t){e.json=JSON.parse(t),e.json.track.allquietsamples?(e.active=!1,setTimeout(function(){e.isLoaded()},1e3)):((t=new XMLHttpRequest).open("GET","".concat(e.location+e.json.track.filename,"_analysis.data"),!0),t.responseType="arraybuffer",t.onload=function(t){this.response&&e.parseData(this.response)},t.send(null))})}},{key:"parseData",value:function(t){var e=new Uint16Array(t),i=0,s=0,s=this.json.structure[0].volume[0];this.volume=e.slice(i,i+s),i+=s,s=this.json.structure[1].balance[0],this.balance=e.slice(i,i+s),i+=s,s=this.json.structure[2].width[0],this.width=e.slice(i,i+s),i+=s,s=this.json.structure[3].centroids[1],this.centroids=[];for(var n=0;n<this.json.structure[3].centroids[0];n++)this.centroids[n]=e.slice(i,i+s),i+=s;s=this.json.structure[4].centroid_indexes[0],this.centroid_indexes=e.slice(i,i+s),i+=s,s=this.json.structure[5].pitch[0],this.pitch=e.slice(i,i+s),i+=s,this.fs=this.json.track.fs,this.fftsize=this.json.track.stft_size,this.binratio=this.fs/this.fftsize,this.multiplyer=this.json.track.byte_num_range,this.factor=1e5,this.maxvolume=this.json.track.maxvolume,this.createObjects()}},{key:"createObjects",value:function(){this.offsetz=-.5,this.offsety=0,this.spread=-.1;var t=new THREE.BoxGeometry(.5,.5,.5),e=new THREE.MeshBasicMaterial({color:16777215,transparent:!0,opacity:0}),t=(this.rootobject=new THREE.Mesh(t,e),this.rootobject.visible=this.visible,this.rootobject.name="rootobject",this.rootobject.position.set(0,this.offsety,this.spread*this.order+this.offsetz),this.stemgroup.add(this.rootobject),this.triangles=new Triangles(this.scene,this,this.color),this.spectrum=new Spectrum(this.scene,this,this.color),new THREE.SphereGeometry(.01,.01,.01)),e=new THREE.MeshBasicMaterial({color:0});this.otherobject=new THREE.Mesh(t,e),this.otherobject.visible=!1,this.rootobject.add(this.otherobject),this.isLoaded()}},{key:"updateVisibility",value:function(t){this.visible=t,this.active&&(this.rootobject.visible=t)}},{key:"updateOrder",value:function(t){this.order=t,this.active&&this.rootobject.position.set(0,this.offsety,this.spread*this.order+this.offsetz)}},{key:"updateColors",value:function(t){this.color=t,this.active&&(this.triangles.updateColor(t),this.spectrum.updateColor(t))}},{key:"hide",value:function(){this.active&&(this.rootobject.visible=!1)}},{key:"show",value:function(){this.active&&(this.rootobject.visible=!0)}},{key:"updateAnimation",value:function(t){this.frame=t,this.active&&(this.triangles.updateTriangles(),this.spectrum.updateSpectrum(),t=+Math.log10(this.volume[this.frame]/this.multiplyer*this.factor*this.maxvolume),Math.log10(this.width[this.frame]/this.multiplyer*this.factor),this.otherobject.scale.y=t=t<=0?1e-4:t,this.otherobject.scale.x=t,this.otherobject.scale.z=t,t=4*(this.balance[this.frame]/this.multiplyer-.5),this.otherobject.position.x=t,this.rootobject.position.x=.5*t,this.json.track.pitchmin,t=this.json.track.pitchmax,30<=this.pitch[this.frame]?(t=Math.log10(this.pitch[this.frame]/this.multiplyer*t*this.factor/this.fs)-1.2,this.otherobject.position.y=t):this.otherobject.position.y=0)}},{key:"loadJSON",value:function(t,e){var i=new XMLHttpRequest;i.overrideMimeType("application/json"),i.open("GET",t,!0),i.onreadystatechange=function(){4==i.readyState&&"200"==i.status&&e(i.responseText)},i.send(null)}}]))(),Detector={canvas:!!window.CanvasRenderingContext2D,webgl:(()=>{try{var t=document.createElement("canvas");return!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(t){return!1}})(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var t=document.createElement("div");return t.id="webgl-error-message",t.style.fontFamily="monospace",t.style.fontSize="13px",t.style.fontWeight="normal",t.style.textAlign="center",t.style.background="#fff",t.style.color="#000",t.style.padding="1.5em",t.style.width="400px",t.style.margin="5em auto 0",this.webgl||(t.innerHTML=(window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.']:['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.']).join("\n")),t}};
//# sourceMappingURL=app.min.map