{"version":3,"sources":["../../../../src/stem.js"],"names":["Stem","location","name","index","order","scene","stemgroup","color","jsonfile","datafile","steminfo","datastructure","loaded","active","visible","volume","balance","width","centroids","centroid_indexes","pitch","isLoaded","onLoaded","init","mythis","json","Object","loadJSON","response","JSON","parse","track","allquietsamples","oReqs","XMLHttpRequest","open","filename","responseType","onload","oEvent","parseData","send","setTimeout","arrayBuffer","data","Uint16Array","head","splicelen","structure","slice","i","fs","fftsize","stft_size","binratio","multiplyer","byte_num_range","factor","maxvolume","createObjects","offsetz","offsety","spread","geometry","THREE","BoxGeometry","material","MeshBasicMaterial","transparent","opacity","rootobject","Mesh","position","set","add","triangles","Triangles","spectrum","Spectrum","SphereGeometry","otherobject","updateColor","frame","updateTriangles","updateSpectrum","Math","log10","scale","y","x","z","posx","pitchmin","pitchmax","thepitch","file","callback","xobj","overrideMimeType","onreadystatechange","readyState","status","responseText"],"mappings":"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","sourcesContent":["class Stem {\n  constructor(location, name, index, order, scene, stemgroup, color) {\n    this.location = location;\n    this.name = name;\n    this.index = index;\n    this.order = order;\n    this.scene = scene;\n    this.stemgroup = stemgroup;\n    this.color = color;\n\n    //Variables\n    //this.jsonfile = `${this.name}_analysis.json?v=${Math.round(Math.random()*1000)}`;\n    this.jsonfile = `${this.name}_analysis.json`;\n    //this.datafile = `${this.name}_analysis.data?v=${Math.round(Math.random()*1000)}`;\n    this.datafile = `${this.name}_analysis.data`;\n    this.steminfo;\n    this.datastructure;\n    this.loaded = false;\n    this.active = true;\n    this.visible = false;\n\n    //Stem data\n    this.volume;\n    this.balance;\n    this.width;\n    this.centroids;\n    this.centroid_indexes;\n    this.pitch;\n\n    //onLoaded handler\n    this.isLoaded = function() {\n      this.loaded = true;\n      if(typeof this.onLoaded === \"function\"){\n        this.onLoaded();\n      }\n    };\n\n    //Initialize\n    this.init();\n  }\n\n  init() {\n    const mythis = this;\n\n    //Load JSON\n    this.json = new Object();\n    this.loadJSON(this.location + this.jsonfile, response => {\n      mythis.json = JSON.parse(response);\n\n      //If not all quite samples, load the data file. Otherwise deactivate.\n      if(!mythis.json.track.allquietsamples){\n        const oReqs = new XMLHttpRequest();\n        //oReqs.open(\"GET\", `${mythis.location + mythis.json.track.filename}_analysis.data?v=${Math.round(Math.random()*1000)}`, true);\n        oReqs.open(\"GET\", `${mythis.location + mythis.json.track.filename}_analysis.data`, true);\n        oReqs.responseType = \"arraybuffer\";\n        oReqs.onload = function (oEvent) {\n          if(this.response){\n            mythis.parseData(this.response);\n          }\n        }\n        oReqs.send(null);\n      }else{\n        mythis.active = false;\n        setTimeout(() => {\n          mythis.isLoaded();\n        }, 1000);\n      }\n    });\n  }\n\n  parseData(arrayBuffer) {\n\n    //Extract data array\n    const data = new Uint16Array(arrayBuffer);\n    let head = 0;\n    let splicelen = 0;\n\n    //volume\n    splicelen = this.json.structure[0].volume[0];\n    this.volume = data.slice(head, head + splicelen);\n    head += splicelen;\n\n    //balance\n    splicelen = this.json.structure[1].balance[0];\n    this.balance = data.slice(head, head + splicelen);\n    head += splicelen;\n\n    //width\n    splicelen = this.json.structure[2].width[0];\n    this.width = data.slice(head, head + splicelen);\n    head += splicelen;\n\n    //stft_clusters\n    splicelen = this.json.structure[3].centroids[1];\n    this.centroids = [];\n    for(let i=0; i<this.json.structure[3].centroids[0]; i++){\n      this.centroids[i] = data.slice(head, head + splicelen);\n      head += splicelen;\n    }\n\n    //centroid_indexes\n    splicelen = this.json.structure[4].centroid_indexes[0];\n    this.centroid_indexes = data.slice(head, head + splicelen);\n    head += splicelen;\n\n    //harmonics\n    splicelen = this.json.structure[5].pitch[0];\n    this.pitch = data.slice(head, head + splicelen);\n    head += splicelen;\n\n    //Static Parameters\n    this.fs = this.json.track.fs;\n    this.fftsize = this.json.track.stft_size;\n    this.binratio = this.fs/this.fftsize;\n    this.multiplyer = this.json.track.byte_num_range; //255, 65535\n    this.factor = 100000;\n    this.maxvolume = this.json.track.maxvolume;\n\n    this.createObjects();\n\n  }\n\n  createObjects() {\n    const mythis = this;\n\n    //Create objects for each track\n    this.offsetz = -0.5;\n    this.offsety = 0;\n    this.spread = -0.1;\n\n    //Root Object\n    var geometry = new THREE.BoxGeometry(0.5, 0.5, 0.5);\n    var material = new THREE.MeshBasicMaterial( { color: 0xffffff, transparent:true, opacity:0.00 } ); //0.03\n    this.rootobject = new THREE.Mesh( geometry, material );\n    this.rootobject.visible = this.visible;\n    this.rootobject.name = 'rootobject';\n    this.rootobject.position.set(0, this.offsety, (this.spread * this.order) + this.offsetz);\n    this.stemgroup.add(this.rootobject);\n\n      //Models\n      //this.helper = new Helper(this.scene, this);\n      this.triangles = new Triangles(this.scene, this, this.color);\n      this.spectrum = new Spectrum(this.scene, this, this.color);\n\n      //Other object\n      var geometry = new THREE.SphereGeometry( 0.01, 0.01, 0.01 );\n      var material = new THREE.MeshBasicMaterial( { color: 0x000000} );\n      this.otherobject = new THREE.Mesh( geometry, material );\n      this.otherobject.visible = false;\n      this.rootobject.add( this.otherobject );\n\n    //Report done loading\n    this.isLoaded();\n  }\n\n  updateVisibility(visible){\n    this.visible = visible;\n    if(this.active){\n      this.rootobject.visible = visible;\n    }\n  }\n\n  updateOrder(order){\n    this.order = order;\n    if(this.active){\n      this.rootobject.position.set(0, this.offsety, (this.spread * this.order) + this.offsetz);\n    }\n  }\n\n  updateColors(color){\n    this.color = color;\n    if(this.active){\n      this.triangles.updateColor(color);\n      this.spectrum.updateColor(color);\n    }\n  }\n\n  hide(){\n    if(this.active){\n      this.rootobject.visible = false;\n    }\n  }\n\n  show(){\n    if(this.active){\n      this.rootobject.visible = true;\n    }\n  }\n\n  updateAnimation(frame) {\n    this.frame = frame;\n    if(this.active){\n\n      //Update models\n      this.triangles.updateTriangles();\n      this.spectrum.updateSpectrum();\n\n      //Variables\n      //const fs = this.json.track.fs;\n      //const fftsize = this.json.track.stft_size;\n      //const binratio = fs/fftsize;\n      //const multiplyer = this.json.track.byte_num_range; //255, 65535\n      //const factor = 100000;\n      //const maxvolume = this.json.track.maxvolume;\n\n      //Volume, Width\n      let volume = Math.log10(this.volume[this.frame] / this.multiplyer * this.factor * this.maxvolume) / 1;// / multiplyer;// * this.json.track.maxvolume; // * 4 + 1;\n      let width = Math.log10(this.width[this.frame] / this.multiplyer * this.factor) / 1;// * this.json.track.maxvolume; // * 10 + 3;\n      if(volume <= 0) volume = 0.0001;\n      if(width <= 0) width = 0.0001;\n      this.otherobject.scale.y = volume;\n      this.otherobject.scale.x = volume;\n      this.otherobject.scale.z = volume;\n\n      //Panning\n      const posx = (this.balance[this.frame] / this.multiplyer-0.5) * 4;\n      this.otherobject.position.x = posx;\n      this.rootobject.position.x = posx * 0.5;\n\n      //Pitch\n      const pitchmin = this.json.track.pitchmin; //50\n      const pitchmax = this.json.track.pitchmax; //2000\n      if(this.pitch[this.frame] >= 30){\n        const thepitch = Math.log10(this.pitch[this.frame] / this.multiplyer * pitchmax * this.factor/this.fs) - 1.2;\n        this.otherobject.position.y = thepitch;\n      }else{\n        this.otherobject.position.y = 0; //Math.log10(pitchmin);\n      }\n    }\n  }\n\n  loadJSON(file, callback) {\n    const xobj = new XMLHttpRequest();\n    xobj.overrideMimeType(\"application/json\");\n    xobj.open('GET', file, true);\n    xobj.onreadystatechange = () => {\n      if(xobj.readyState == 4 && xobj.status == \"200\") {callback(xobj.responseText);}\n    };\n    xobj.send(null);\n  }\n}\n"],"file":"stem-compiled.js"}