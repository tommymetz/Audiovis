{"version":3,"file":"song_gui-compiled.js","names":["SongGui","parent","_classCallCheck","mythis","visible","state","location","order","colorset","colors","container","document","createElement","appendChild","setAttribute","menu","title","status_changed","status","button_load","innerHTML","button_save","stems","stems_list","_createClass","key","value","init","_this","mp3file","addEventListener","e","preventDefault","loadState","console","log","saveState","stemlist","Array","length","forEach","element","index","name","color","active","elementindex","target","parentElement","getAttribute","updateStemColor","solo","updateSoloing","checked","className","sortable","Sortable","create","onEnd","evt","neworder","children","i","parseInt","updateStemOrder","updateVisibility","classList","remove","add","which","xhttp","XMLHttpRequest","onreadystatechange","readyState","JSON","parse","responseText","open","setRequestHeader","send","stringify"],"sources":["../../../../src/song_gui.js"],"sourcesContent":["class SongGui {\n\n  constructor(parent){\n    const mythis = this;\n    this.parent = parent;\n    this.visible = false;\n\n    //State\n    this.state = {\n      location: parent.location,\n      order:[],\n      colorset:'colorsWarmCold',\n      colors:[]\n    };\n\n    //Gui Container\n    this.container = document.createElement('div');\n    this.parent.parent.container.appendChild(this.container);\n    this.container.setAttribute('class', 'song-gui gui-container hidden');\n\n      //Menu Bar\n      this.menu = document.createElement('div');\n      this.container.appendChild(this.menu);\n      this.menu.setAttribute('class', 'gui-menu');\n\n        //Song Title\n        this.title = document.createElement('div');\n        this.menu.appendChild(this.title);\n        this.title.setAttribute('class', 'gui-item gui-item_title');\n\n        //Changed\n        this.status_changed = document.createElement('div');\n        this.menu.appendChild(this.status_changed);\n        this.status_changed.setAttribute('class', 'gui-item gui-item_changed');\n\n        //Loading\n        this.status = document.createElement('div');\n        this.menu.appendChild(this.status);\n        this.status.setAttribute('class', 'gui-item gui-item_status');\n\n        //Stop\n        //this.button_stop = document.createElement('a');\n        //this.menu.appendChild(this.button_stop);\n        //this.button_stop.setAttribute('class', 'gui-item');\n        //this.button_stop.setAttribute('href', '#');\n        //this.button_stop.innerHTML = 'stop';\n\n        //Load\n        this.button_load = document.createElement('a');\n        this.menu.appendChild(this.button_load);\n        this.button_load.setAttribute('class', 'gui-item');\n        this.button_load.setAttribute('href', '#');\n        this.button_load.innerHTML = 'load';\n\n        //Save\n        this.button_save = document.createElement('a');\n        this.menu.appendChild(this.button_save);\n        this.button_save.setAttribute('class', 'gui-item');\n        this.button_save.setAttribute('href', '#');\n        this.button_save.innerHTML = 'save';\n\n\n      //Stems - https://github.com/RubaXa/Sortable\n      this.stems = [];\n      this.stems_list = document.createElement('ul');\n      this.container.appendChild(this.stems_list);\n      this.stems_list.setAttribute('class', 'gui-list');\n  }\n\n  init(){\n    const mythis = this;\n\n    this.title.innerHTML = this.parent.mp3file;\n\n    //Menu Buttons\n    //this.button_stop.addEventListener('click', e => {\n    //  e.preventDefault();\n    //  mythis.parent.parent.stop();\n    //});\n    this.button_load.addEventListener('click', e => {\n      e.preventDefault();\n      if(this.visible){\n        mythis.loadState();\n      }else{\n        console.log('fuck off');\n      }\n    });\n    this.button_save.addEventListener('click', e => {\n      e.preventDefault();\n      if(this.visible){\n        mythis.saveState();\n      }else{\n        console.log('fuck off');\n      }\n    });\n\n    //Parameters\n    this.state.colors = this.parent.colors;\n    this.state.order = this.parent.order;\n\n    //Tracks\n    var stemlist = new Array(this.parent.stems.length);\n    this.parent.stems.forEach(function(element, index){\n      const order = element.order;\n      mythis.stems[index] = document.createElement('li');\n      mythis.stems[index].setAttribute('data-index', index);\n\n        //Name\n        const name = document.createElement('div');\n        name.setAttribute('class', 'name');\n        name.innerHTML = mythis.parent.stems[index].name;\n        mythis.stems[index].appendChild(name);\n\n        //Color\n        const color = document.createElement('input');\n        color.setAttribute('type', 'color');\n        color.setAttribute('value', mythis.state.colors[index]);\n        if(!mythis.parent.stems[index].active) color.setAttribute('disabled', true);\n        mythis.stems[index].appendChild(color);\n        color.addEventListener('input', function(e){\n          mythis.status_changed.innerHTML = '*';\n          const elementindex = e.target.parentElement.getAttribute('data-index');\n          mythis.state.colors[elementindex] = e.target.value;\n          mythis.parent.updateStemColor(elementindex, e.target.value);\n        }, false);\n\n        //Solo Checkbox\n        const solo = document.createElement('input');\n        solo.setAttribute('type', 'checkbox');\n        if(!mythis.parent.stems[index].active) solo.setAttribute('disabled', true);\n        mythis.stems[index].appendChild(solo);\n        solo.addEventListener('change', function(e){\n          const elementindex = e.target.parentElement.getAttribute('data-index');\n          mythis.parent.updateSoloing(elementindex, this.checked);\n          mythis.updateSoloing(elementindex, this.checked);\n        });\n\n\n      if(!mythis.parent.stems[index].active) mythis.stems[index].className += 'inactive';\n      stemlist[element.order] = mythis.stems[index];\n    });\n    stemlist.forEach(function(element, index){\n      mythis.stems_list.appendChild(element);\n    });\n\n    //Sortable\n    var sortable = Sortable.create(mythis.stems_list, {\n    \tonEnd: function(evt){\n        let neworder = new Array(evt.target.children.length);\n        for (var i = 0; i < evt.target.children.length; ++i) {\n          neworder[parseInt(evt.target.children[i].getAttribute('data-index'))] = i;\n        }\n        mythis.state.order = neworder;\n        mythis.parent.updateStemOrder(neworder);\n        mythis.status_changed.innerHTML = '*';\n    \t},\n    });\n  }\n\n  updateVisibility(visible){\n    this.visible = visible;\n    if(visible){\n      this.container.classList.remove('hidden');\n    }else{\n      this.container.classList.add('hidden');\n    }\n  }\n\n  updateSoloing(which, checked){\n    if(checked){\n      this.stems.forEach(function(element, index){\n        if(which != index) element.classList.add('hidden');\n      });\n    }else{\n      this.stems.forEach(function(element, index){\n        element.classList.remove('hidden');\n      });\n    }\n  }\n\n  loadState(){\n    console.log('load state');\n  }\n\n  saveState(){\n    var mythis = this;\n    this.status.innerHTML = 'saving';\n    var xhttp = new XMLHttpRequest();\n    xhttp.onreadystatechange = function() {\n      if (this.readyState == 4 && this.status == 200) {\n        mythis.status.innerHTML = '';\n        mythis.status_changed.innerHTML = '';\n        console.log(JSON.parse(this.responseText));\n      }\n    };\n    xhttp.open(\"POST\", \"/config/save\", true);\n    xhttp.setRequestHeader(\"Content-type\", \"application/json\");\n    xhttp.send(JSON.stringify(this.state));\n  }\n}\n\n\n\n\n\n\n\n\n//\n"],"mappings":"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","ignoreList":[]}