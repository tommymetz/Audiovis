{"version":3,"sources":["../../../../src/song_gui.js"],"names":["SongGui","parent","mythis","visible","state","location","order","colorset","colors","container","document","createElement","appendChild","setAttribute","menu","title","status_changed","status","button_load","innerHTML","button_save","stems","stems_list","mp3file","addEventListener","e","preventDefault","loadState","saveState","stemlist","Array","length","forEach","element","index","name","color","active","elementindex","target","parentElement","getAttribute","value","updateStemColor","solo","updateSoloing","checked","className","sortable","Sortable","create","onEnd","evt","neworder","children","i","parseInt","updateStemOrder","classList","remove","add","which","console","log","xhttp","XMLHttpRequest","onreadystatechange","readyState","JSON","parse","responseText","open","setRequestHeader","send","stringify"],"mappings":"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","sourcesContent":["class SongGui {\n\n  constructor(parent){\n    const mythis = this;\n    this.parent = parent;\n    this.visible = false;\n\n    //State\n    this.state = {\n      location: parent.location,\n      order:[],\n      colorset:'colorsWarmCold',\n      colors:[]\n    };\n\n    //Gui Container\n    this.container = document.createElement('div');\n    this.parent.parent.container.appendChild(this.container);\n    this.container.setAttribute('class', 'song-gui gui-container hidden');\n\n      //Menu Bar\n      this.menu = document.createElement('div');\n      this.container.appendChild(this.menu);\n      this.menu.setAttribute('class', 'gui-menu');\n\n        //Song Title\n        this.title = document.createElement('div');\n        this.menu.appendChild(this.title);\n        this.title.setAttribute('class', 'gui-item gui-item_title');\n\n        //Changed\n        this.status_changed = document.createElement('div');\n        this.menu.appendChild(this.status_changed);\n        this.status_changed.setAttribute('class', 'gui-item gui-item_changed');\n\n        //Loading\n        this.status = document.createElement('div');\n        this.menu.appendChild(this.status);\n        this.status.setAttribute('class', 'gui-item gui-item_status');\n\n        //Stop\n        //this.button_stop = document.createElement('a');\n        //this.menu.appendChild(this.button_stop);\n        //this.button_stop.setAttribute('class', 'gui-item');\n        //this.button_stop.setAttribute('href', '#');\n        //this.button_stop.innerHTML = 'stop';\n\n        //Load\n        this.button_load = document.createElement('a');\n        this.menu.appendChild(this.button_load);\n        this.button_load.setAttribute('class', 'gui-item');\n        this.button_load.setAttribute('href', '#');\n        this.button_load.innerHTML = 'load';\n\n        //Save\n        this.button_save = document.createElement('a');\n        this.menu.appendChild(this.button_save);\n        this.button_save.setAttribute('class', 'gui-item');\n        this.button_save.setAttribute('href', '#');\n        this.button_save.innerHTML = 'save';\n\n\n      //Stems - https://github.com/RubaXa/Sortable\n      this.stems = [];\n      this.stems_list = document.createElement('ul');\n      this.container.appendChild(this.stems_list);\n      this.stems_list.setAttribute('class', 'gui-list');\n  }\n\n  init(){\n    const mythis = this;\n\n    this.title.innerHTML = this.parent.mp3file;\n\n    //Menu Buttons\n    //this.button_stop.addEventListener('click', e => {\n    //  e.preventDefault();\n    //  mythis.parent.parent.stop();\n    //});\n    this.button_load.addEventListener('click', e => {\n      e.preventDefault();\n      mythis.loadState();\n    });\n    this.button_save.addEventListener('click', e => {\n      e.preventDefault();\n      mythis.saveState();\n    });\n\n    //Parameters\n    this.state.colors = this.parent.colors;\n    this.state.order = this.parent.order;\n\n    //Tracks\n    var stemlist = new Array(this.parent.stems.length);\n    this.parent.stems.forEach(function(element, index){\n      const order = element.order;\n      mythis.stems[index] = document.createElement('li');\n      mythis.stems[index].setAttribute('data-index', index);\n\n        //Name\n        const name = document.createElement('div');\n        name.setAttribute('class', 'name');\n        name.innerHTML = mythis.parent.stems[index].name;\n        mythis.stems[index].appendChild(name);\n\n        //Color\n        const color = document.createElement('input');\n        color.setAttribute('type', 'color');\n        color.setAttribute('value', mythis.state.colors[index]);\n        if(!mythis.parent.stems[index].active) color.setAttribute('disabled', true);\n        mythis.stems[index].appendChild(color);\n        color.addEventListener('input', function(e){\n          mythis.status_changed.innerHTML = '*';\n          const elementindex = e.target.parentElement.getAttribute('data-index');\n          mythis.state.colors[elementindex] = e.target.value;\n          mythis.parent.updateStemColor(elementindex, e.target.value);\n        }, false);\n\n        //Solo Checkbox\n        const solo = document.createElement('input');\n        solo.setAttribute('type', 'checkbox');\n        if(!mythis.parent.stems[index].active) solo.setAttribute('disabled', true);\n        mythis.stems[index].appendChild(solo);\n        solo.addEventListener('change', function(e){\n          const elementindex = e.target.parentElement.getAttribute('data-index');\n          mythis.parent.updateSoloing(elementindex, this.checked);\n          mythis.updateSoloing(elementindex, this.checked);\n        });\n\n\n      if(!mythis.parent.stems[index].active) mythis.stems[index].className += 'inactive';\n      stemlist[element.order] = mythis.stems[index];\n    });\n    stemlist.forEach(function(element, index){\n      mythis.stems_list.appendChild(element);\n    });\n\n    //Sortable\n    var sortable = Sortable.create(mythis.stems_list, {\n    \tonEnd: function(evt){\n        let neworder = new Array(evt.target.children.length);\n        for (var i = 0; i < evt.target.children.length; ++i) {\n          neworder[parseInt(evt.target.children[i].getAttribute('data-index'))] = i;\n        }\n        mythis.state.order = neworder;\n        mythis.parent.updateStemOrder(neworder);\n        mythis.status_changed.innerHTML = '*';\n    \t},\n    });\n  }\n\n  updateVisibility(visible){\n    this.visible = visible;\n    if(visible){\n      this.container.classList.remove('hidden');\n    }else{\n      this.container.classList.add('hidden');\n    }\n  }\n\n  updateSoloing(which, checked){\n    if(checked){\n      this.stems.forEach(function(element, index){\n        if(which != index) element.classList.add('hidden');\n      });\n    }else{\n      this.stems.forEach(function(element, index){\n        element.classList.remove('hidden');\n      });\n    }\n  }\n\n  loadState(){\n    console.log('load state');\n  }\n\n  saveState(){\n    var mythis = this;\n    this.status.innerHTML = 'saving';\n    var xhttp = new XMLHttpRequest();\n    xhttp.onreadystatechange = function() {\n      if (this.readyState == 4 && this.status == 200) {\n        mythis.status.innerHTML = '';\n        mythis.status_changed.innerHTML = '';\n        console.log(JSON.parse(this.responseText));\n      }\n    };\n    xhttp.open(\"POST\", \"/config/save\", true);\n    xhttp.setRequestHeader(\"Content-type\", \"application/json\");\n    xhttp.send(JSON.stringify(this.state));\n  }\n}\n\n\n\n\n\n\n\n\n//\n"],"file":"song_gui-compiled.js"}